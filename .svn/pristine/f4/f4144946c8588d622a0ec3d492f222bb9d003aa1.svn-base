angular.module('vnNavigationModule', [],function () {})
.factory('vnNavigationFactory',  function( $rootScope, $timeout, vnAppManagementFactory ){
	var factory = {};

	$rootScope.screens = {};
	$rootScope.screens[ "VN_LOGIN" ] = true;
	var screenHistory = new Array();
	factory.SCREEN_CURRENT = 0;
	factory.SCREEN_PREVIOUS = 1;
	

  	factory.switchScreens = function( to ){
  		angular.forEach( $rootScope.screens, function( value, index ){
			$rootScope.screens[ index ] = false;
		});
		$timeout( function(){
			$rootScope.screens[to] = true;
			// I'm only keeping current and previous at the moment
			var screenHistoryLength = screenHistory.unshift( to );
			if( screenHistoryLength > 2 ){
				screenHistory.pop();
			}
			var appName = to.split( '__' );
			if( appName != null ){
				$rootScope.screens[appName[0]] = true;
				var app = vnAppManagementFactory.getApp( appName[0] );
				if( app != null ){
					$rootScope.currentapp = app;	
				}
			}
		}, 1, true );
	 }; 

	 factory.retrieveScreenFromHistory = function( screenHistoryIndex ){
	 	return screenHistory[ screenHistoryIndex ];
	 };
	return factory;
});
