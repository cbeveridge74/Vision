angular.module('vnReceptionModule', [ 
	'vnPeopleModule', 
	'vnDiscussionsModule',
	'vnAppointmentsModule',
	'vnTaskModule',
	'vnPrescriptionModule',
	'vnCorrespondenceModule',
	'vnAnnouncementsModule',
	'vnDetailViewModule',
	'vnCreateViewModule'],function () {})
.run(function( vnAppManagementFactory ){
	var APP_ID 	= "VN_REP";
	var HOME 	= APP_ID + '__HOME';
	var PATIENT = APP_ID + '__PATIENT';

	vnAppManagementFactory.registerApp( 
		{ id: "VN_REP", 
		name: "Vision Reception",
		icon: "images/reception_bell.svg",
		defaultapp: true,
		screens: [
			HOME,
			PATIENT
		]});
})
.controller('vnReceptionController', function( 
	$scope, 
	$timeout, 
	vnNavigationFactory,
	vnScreenManagementFactory,
	vnScrollFactory,
	vnCreateViewFactory,
	VN_REP_SCREENS,
	VN_TASK_SCREENS ){
	
	$scope.backbutton = false;
	$scope.createtask = false;

	$scope.init = function () {
      $scope.$watchGroup( [
      	"screens." + VN_REP_SCREENS.HOME, 
      	"screens." + VN_REP_SCREENS.PATIENT], function( newValues, oldValues, scope ){
        if( newValues[0] || newValues[1] ){
          handleResize();
        }
      });
      handleResize();
      
  	};

	$( window ).resize(function() {
        handleResize();
      });

	$scope.handleSearchSelected = function(){
        vnNavigationFactory.switchScreens( VN_REP_SCREENS.PATIENT );
    };

    $scope.handleBackButton = function(){
    	vnNavigationFactory.switchScreens( VN_REP_SCREENS.HOME);
    };

    $scope.handleTaskTitleClick = function(){
    	vnNavigationFactory.switchScreens( 'VN_TASK__HOME' );
    };

    $scope.handleAppointmentsTitleClick = function(){
    	vnNavigationFactory.switchScreens( 'VN_APP__DAY' );
    };

    $scope.handleAnnouncementsTitleClick = function(){
    	vnNavigationFactory.switchScreens( 'VN_ANNOUNCEMENTS__HOME' );
    };

    $scope.announcementAddClickHandler = function(){
    	vnCreateViewFactory.clearModel();
		vnScreenManagementFactory.openMenu( ".vision-reception .announcements-cat .create-view" );
    };

    $scope.taskAddClickHandler = function( ){
		
		vnCreateViewFactory.clearModel();
		vnScreenManagementFactory.openMenu( ".vision-reception .tasks-cat .create-view" );
		
    };

    var handleResize = function(){
    	$timeout( function(){
    		vnScrollFactory.handleResize( "home" );
    		vnScrollFactory.handleResize( "patient" );
    	}, 1);
    	
    };
})
.directive('vnReception', function() {
    return {
      restrict: 'E',
      templateUrl: 'apps/visionreception/vnreception.html'
    };
})
.value('VN_REP_SCREENS',  { 
	HOME: "VN_REP__HOME",
	PATIENT: "VN_REP__PATIENT" 
});