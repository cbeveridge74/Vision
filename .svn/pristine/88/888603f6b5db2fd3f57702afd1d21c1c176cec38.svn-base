angular.module('vnLoginModule', [],function () {})//'ngTouch'
.controller('vnLoginController', function(
  $scope, 
  $window, 
  visionFactory, 
  vnNavigationFactory,
  vnAppManagementFactory){
  $scope.user = {};
  $scope.user.username = 'chris@nhs.net';
  $scope.user.password = 'Password4';
  $scope.version = chrome.runtime.getManifest().version;
  $scope.name = chrome.runtime.getManifest().name;
  
  $scope.init = function(){
    $scope.$watch('screens.VN_LOGIN', function( value ){
          if( value == true ){
            setTimeout( function(){
              handleResize();
              $( window ).resize(function() {
            handleResize();
          });
            }, 1);
          }
        });
  };

  $scope.handleLoginClick= function(){
    visionFactory.authenticate( $scope.user.username, $scope.user.password, handleAuthentication );
  }

  var handleAuthentication = function(){
    vnNavigationFactory.switchScreens( vnAppManagementFactory.getDefaultApp().screens[0] );
  };

  var handleResize = function(){
      // Set the width of the slider
      $( ".login" ).width( $window.innerWidth );
      $( ".login" ).height( $window.innerHeight );
      $( ".login" ).on("online", function () {});
    }
})
.directive('vnLogin', function() {
    return {
      restrict: 'E',
      templateUrl: 'authentication/vnlogin.html'
    };
  });;